/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/
!function(){function a(a){return a.replace(t,"").replace(u,",").replace(v,"").replace(w,"").replace(x,"").split(y)}function b(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function c(c,d){function e(a){return m+=a.split(/\n/).length-1,k&&(a=a.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),a&&(a=s[1]+b(a)+s[2]+"\n"),a}function f(b){var c=m;if(j?b=j(b,d):g&&(b=b.replace(/\n/g,function(){return m++,"$line="+m+";"})),0===b.indexOf("=")){var e=l&&!/^=[=#]/.test(b);if(b=b.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=b.replace(/\s*\([^\)]+\)/,"");n[f]||/^(include|print)$/.test(f)||(b="$escape("+b+")")}else b="$string("+b+")";b=s[1]+b+s[2]}return g&&(b="$line="+c+";"+b),r(a(b),function(a){if(a&&!p[a]){var b;b="print"===a?u:"include"===a?v:n[a]?"$utils."+a:o[a]?"$helpers."+a:"$data."+a,w+=a+"="+b+",",p[a]=!0}}),b+"\n"}var g=d.debug,h=d.openTag,i=d.closeTag,j=d.parser,k=d.compress,l=d.escape,m=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,s=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],t=q?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+t+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+t+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),x=s[0],y="return new String("+s[3]+");";r(c.split(h),function(a){a=a.split(i);var b=a[0],c=a[1];1===a.length?x+=e(b):(x+=f(b),c&&(x+=e(c)))});var z=w+x+y;g&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+b(c)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$filename",z);return A.prototype=n,A}catch(B){throw B.temp="function anonymous($data,$filename) {"+z+"}",B}}var d=function(a,b){return"string"==typeof b?q(b,{filename:a}):g(a,b)};d.version="3.0.0",d.config=function(a,b){e[a]=b};var e=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},f=d.cache={};d.render=function(a,b){return q(a,b)};var g=d.renderFile=function(a,b){var c=d.get(a)||p({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(f[a])b=f[a];else if("object"==typeof document){var c=document.getElementById(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");b=q(d,{filename:a})}}return b};var h=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?h(a.call(a)):""),a},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},j=function(a){return i[a]},k=function(a){return h(a).replace(/&(?![\w#]+;)|[<>"']/g,j)},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},m=function(a,b){var c,d;if(l(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)},n=d.utils={$helpers:{},$include:g,$string:h,$escape:k,$each:m};d.helper=function(a,b){o[a]=b};var o=d.helpers=n.$helpers;d.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var p=function(a){return d.onerror(a),function(){return"{Template Error}"}},q=d.compile=function(a,b){function d(c){try{return new i(c,h)+""}catch(d){return b.debug?p(d)():(b.debug=!0,q(a,b)(c))}}b=b||{};for(var g in e)void 0===b[g]&&(b[g]=e[g]);var h=b.filename;try{var i=c(a,b)}catch(j){return j.filename=h||"anonymous",j.name="Syntax Error",p(j)}return d.prototype=i.prototype,d.toString=function(){return i.toString()},h&&b.cache&&(f[h]=d),d},r=n.$each,s="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",t=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,u=/[^\w$]+/g,v=new RegExp(["\\b"+s.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),w=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,y=/^$|,+/;"function"==typeof define?define(function(){return d}):"undefined"!=typeof exports?module.exports=d:this.template=d}();
/*
 * pagination.js 2.0.8
 * A jQuery plugin to provide simple yet fully customisable pagination.
 * https://github.com/superRaytin/paginationjs
 *
 * Homepage: http://pagination.js.org
 *
 * Copyright 2014-2100, superRaytin
 * Released under the MIT license.
 */

(function(global, $) {
  //请求
  if(sessionStorage.getItem('id_token')){
      $.ajaxSetup({
          headers: {         
            'Authorization':'Bearer ' +  sessionStorage.getItem('id_token')
          }
      });
    }
    var _ajax = $.ajax;
    $.ajax = function(opt){
      var temp = opt.temp;
      var fn = {
        error:function(jqXHR,textStatus,errorThrown){},
        success:function(data,textStatus,jqXHR){}
      }
      if(opt.error){
        fn.error = opt.error; 
      }

      if(opt.success){
        fn.success = opt.success;
      }

    
      if(typeof opt.data === 'object'){
        opt.data = JSON.stringify(opt.data);
      }
      
      var _opt = $.extend(opt,{
        contentType:'application/json;charset=UTF-8',
        error:function(jqXHR,textStatus,errorThrown){
            var ret = fn.error(jqXHR,textStatus,errorThrown);
            if(ret == undefined || ret == true){
                if(jqXHR.status == 'undefined'){
                  return;
                }
                alert(jqXHR.responseText);
            } 
          },
          success:function(data,textStatus,jqXHR){
            if(data){
                if(data.id_token){
                  sessionStorage.setItem('id_token',data.id_token);
                  $.ajaxSetup({
                      headers: {         
                        'Authorization':'Bearer ' +  sessionStorage.getItem('id_token')
                      }
                  });
                }
                if(temp){

                  var list = {
                                data : data
                              }
                  var temp_child = $(temp).children('script');
                  var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';
                  var maxPos = $chars.length; 
                  var randomId = '';
                  for (i = 0; i < 6; i++) {  
                      randomId += $chars.charAt(Math.floor(Math.random() * maxPos));  
                  }
                  temp_child.attr('id',randomId);
                  $(temp).html(template(randomId,list));
                }
            }
            fn.success(data,textStatus,jqXHR); 
          }
      });
      return _ajax(_opt);
    }

    //分页
    $.fn.paging = function(obj){
      var url = obj.url;
      var pageSize = obj.pageSize || 10;
      var callBack = obj.callback;
      var _this = $(this);
      var name = _this.attr('id');
      var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';
      var maxPos = $chars.length; 
      var randomId = '';
      for (i = 0; i < 6; i++) {  
          randomId += $chars.charAt(Math.floor(Math.random() * maxPos));  
      }

      var container = $('#pagination-' + name);
      var options = {
            dataSource: function(done){
              $.ajax({
                  type: 'GET',
                  url: url,
                  success: function(data,textStatus,jqXHR){
                    done(data);
                  },
                  error:function(jqXHR,textStatus,errorThrown){
                    alert(jqXHR.responseText);
                  }
              });
            },
            pageSize: pageSize,
            showGoInput: true,
            showGoButton: true,
            callback: function (response, pagination) {
              _this.children('script').attr('id',randomId);                 
              var list = {
                  data : response
              }
              _this.html(template(randomId,list));
              if(callBack){
                  callBack();
              }
            }
        };

        container.pagination(options);
    }

  if (typeof $ === 'undefined') {
    throwError('Pagination requires jQuery.');
  }

  var pluginName = 'pagination';

  var pluginHookMethod = 'addHook';

  var eventPrefix = '__pagination-';

  // Conflict, use backup
  if ($.fn.pagination) {
    pluginName = 'pagination2';
  }

  $.fn[pluginName] = function(options) {

    if (typeof options === 'undefined') {
      return this;
    }

    var container = $(this);

    var pagination = {

      initialize: function() {
        var self = this;

        // Save attributes of current instance
        if (!container.data('pagination')) {
          container.data('pagination', {});
        }

        // Before initialize
        if (self.callHook('beforeInit') === false) return;

        // If pagination has been initialized, destroy it
        if (container.data('pagination').initialized) {
          $('.paginationjs', container).remove();
        }

        // Whether to disable Pagination at the initialization
        self.disabled = !!attributes.disabled;

        // Passed to the callback function
        var model = self.model = {
          pageRange: attributes.pageRange,
          pageSize: attributes.pageSize
        };

        // "dataSource"`s type is unknown, parse it to find true data
        self.parseDataSource(attributes.dataSource, function(dataSource) {

          // Whether pagination is sync mode
          self.sync = Helpers.isArray(dataSource);
          if (self.sync) {
            model.totalNumber = attributes.totalNumber = dataSource.length;
          }

          // Obtain the total number of pages
          model.totalPage = self.getTotalPage();

          // Less than one page
          if (attributes.hideWhenLessThanOnePage) {
            if (model.totalPage <= 1) return;
          }

          var el = self.render(true);

          // Extra className
          if (attributes.className) {
            el.addClass(attributes.className);
          }

          model.el = el;

          // Load template
          container[attributes.position === 'bottom' ? 'append' : 'prepend'](el);

          // Binding events
          self.observer();

          // initialized flag
          container.data('pagination').initialized = true;

          // After initialized
          self.callHook('afterInit', el);
        });
      },

      render: function(isBoot) {
        var self = this;
        var model = self.model;
        var el = model.el || $('<div class="paginationjs"></div>');
        var isForced = isBoot !== true;

        // Before render
        self.callHook('beforeRender', isForced);

        var currentPage = model.pageNumber || attributes.pageNumber;
        var pageRange = attributes.pageRange;
        var totalPage = model.totalPage;

        var rangeStart = currentPage - pageRange;
        var rangeEnd = currentPage + pageRange;

        if (rangeEnd > totalPage) {
          rangeEnd = totalPage;
          rangeStart = totalPage - pageRange * 2;
          rangeStart = rangeStart < 1 ? 1 : rangeStart;
        }

        if (rangeStart <= 1) {
          rangeStart = 1;

          rangeEnd = Math.min(pageRange * 2 + 1, totalPage);
        }

        el.html(self.createTemplate({
          currentPage: currentPage,
          pageRange: pageRange,
          totalPage: totalPage,
          rangeStart: rangeStart,
          rangeEnd: rangeEnd
        }));

        // After render
        self.callHook('afterRender', isForced);

        return el;
      },

      // Create template
      createTemplate: function(args) {
        var self = this;
        var currentPage = args.currentPage;
        var totalPage = args.totalPage;
        var rangeStart = args.rangeStart;
        var rangeEnd = args.rangeEnd;

        var totalNumber = attributes.totalNumber;

        var showPrevious = attributes.showPrevious;
        var showNext = attributes.showNext;
        var showPageNumbers = attributes.showPageNumbers;
        var showNavigator = attributes.showNavigator;
        var showGoInput = attributes.showGoInput;
        var showGoButton = attributes.showGoButton;

        var pageLink = attributes.pageLink;
        var prevText = attributes.prevText;
        var nextText = attributes.nextText;
        var ellipsisText = attributes.ellipsisText;
        var goButtonText = attributes.goButtonText;

        var classPrefix = attributes.classPrefix;
        var activeClassName = attributes.activeClassName;
        var disableClassName = attributes.disableClassName;
        var ulClassName = attributes.ulClassName;

        var formatNavigator = $.isFunction(attributes.formatNavigator) ? attributes.formatNavigator() : attributes.formatNavigator;
        var formatGoInput = $.isFunction(attributes.formatGoInput) ? attributes.formatGoInput() : attributes.formatGoInput;
        var formatGoButton = $.isFunction(attributes.formatGoButton) ? attributes.formatGoButton() : attributes.formatGoButton;

        var autoHidePrevious = $.isFunction(attributes.autoHidePrevious) ? attributes.autoHidePrevious() : attributes.autoHidePrevious;
        var autoHideNext = $.isFunction(attributes.autoHideNext) ? attributes.autoHideNext() : attributes.autoHideNext;

        var header = $.isFunction(attributes.header) ? attributes.header() : attributes.header;
        var footer = $.isFunction(attributes.footer) ? attributes.footer() : attributes.footer;

        var html = '';
        var goInput = '<input type="text" class="J-paginationjs-go-pagenumber">';
        var goButton = '<input type="button" class="J-paginationjs-go-button" value="' + goButtonText + '">';
        var formattedString;
        var i;

        if (header) {
          formattedString = self.replaceVariables(header, {
            currentPage: currentPage,
            totalPage: totalPage,
            totalNumber: totalNumber
          });
          html += formattedString;
        }

        if (showPrevious || showPageNumbers || showNext) {
          html += '<div class="paginationjs-pages">';

          if (ulClassName) {
            html += '<ul class="' + ulClassName + '">';
          } else {
            html += '<ul>';
          }

          // Previous page button
          if (showPrevious) {
            if (currentPage === 1) {
              if (!autoHidePrevious) {
                html += '<li class="' + classPrefix + '-prev ' + disableClassName + '"><a>' + prevText + '<\/a><\/li>';
              }
            } else {
              html += '<li class="' + classPrefix + '-prev J-paginationjs-previous" data-num="' + (currentPage - 1) + '" title="Previous page"><a href="' + pageLink + '">' + prevText + '<\/a><\/li>';
            }
          }

          // Page numbers
          if (showPageNumbers) {
            if (rangeStart <= 3) {
              for (i = 1; i < rangeStart; i++) {
                if (i == currentPage) {
                  html += '<li class="' + classPrefix + '-page J-paginationjs-page ' + activeClassName + '" data-num="' + i + '"><a>' + i + '<\/a><\/li>';
                } else {
                  html += '<li class="' + classPrefix + '-page J-paginationjs-page" data-num="' + i + '"><a href="' + pageLink + '">' + i + '<\/a><\/li>';
                }
              }
            } else {
              if (attributes.showFirstOnEllipsisShow) {
                html += '<li class="' + classPrefix + '-page ' + classPrefix + '-first J-paginationjs-page" data-num="1"><a href="' + pageLink + '">1<\/a><\/li>';
              }
              html += '<li class="' + classPrefix + '-ellipsis ' + disableClassName + '"><a>' + ellipsisText + '<\/a><\/li>';
            }

            // Main loop
            for (i = rangeStart; i <= rangeEnd; i++) {
              if (i == currentPage) {
                html += '<li class="' + classPrefix + '-page J-paginationjs-page ' + activeClassName + '" data-num="' + i + '"><a>' + i + '<\/a><\/li>';
              } else {
                html += '<li class="' + classPrefix + '-page J-paginationjs-page" data-num="' + i + '"><a href="' + pageLink + '">' + i + '<\/a><\/li>';
              }
            }

            if (rangeEnd >= totalPage - 2) {
              for (i = rangeEnd + 1; i <= totalPage; i++) {
                html += '<li class="' + classPrefix + '-page J-paginationjs-page" data-num="' + i + '"><a href="' + pageLink + '">' + i + '<\/a><\/li>';
              }
            } else {
              html += '<li class="' + classPrefix + '-ellipsis ' + disableClassName + '"><a>' + ellipsisText + '<\/a><\/li>';

              if (attributes.showLastOnEllipsisShow) {
                html += '<li class="' + classPrefix + '-page ' + classPrefix + '-last J-paginationjs-page" data-num="' + totalPage + '"><a href="' + pageLink + '">' + totalPage + '<\/a><\/li>';
              }
            }
          }

          // Next page button
          if (showNext) {
            if (currentPage == totalPage) {
              if (!autoHideNext) {
                html += '<li class="' + classPrefix + '-next ' + disableClassName + '"><a>' + nextText + '<\/a><\/li>';
              }
            } else {
              html += '<li class="' + classPrefix + '-next J-paginationjs-next" data-num="' + (currentPage + 1) + '" title="Next page"><a href="' + pageLink + '">' + nextText + '<\/a><\/li>';
            }
          }
          html += '<\/ul><\/div>';
        }

        // Navigator
        if (showNavigator) {
          if (formatNavigator) {
            formattedString = self.replaceVariables(formatNavigator, {
              currentPage: currentPage,
              totalPage: totalPage,
              totalNumber: totalNumber
            });
            html += '<div class="' + classPrefix + '-nav J-paginationjs-nav">' + formattedString + '<\/div>';
          }
        }

        // Go input
        if (showGoInput) {
          if (formatGoInput) {
            formattedString = self.replaceVariables(formatGoInput, {
              currentPage: currentPage,
              totalPage: totalPage,
              totalNumber: totalNumber,
              input: goInput
            });
            html += '<div class="' + classPrefix + '-go-input">' + formattedString + '</div>';
          }
        }

        // Go button
        if (showGoButton) {
          if (formatGoButton) {
            formattedString = self.replaceVariables(formatGoButton, {
              currentPage: currentPage,
              totalPage: totalPage,
              totalNumber: totalNumber,
              button: goButton
            });
            html += '<div class="' + classPrefix + '-go-button">' + formattedString + '</div>';
          }
        }

        if (footer) {
          formattedString = self.replaceVariables(footer, {
            currentPage: currentPage,
            totalPage: totalPage,
            totalNumber: totalNumber
          });
          html += formattedString;
        }

        return html;
      },

      // Go to the specified page
      go: function(number, callback) {
        var self = this;
        var model = self.model;

        if (self.disabled) return;

        var pageNumber = number;
        var pageSize = attributes.pageSize;
        var totalPage = model.totalPage;

        pageNumber = parseInt(pageNumber);

        // Page number out of bounds
        if (!pageNumber || pageNumber < 1 || pageNumber > totalPage) return;

        // Sync mode
        if (self.sync) {
          render(self.getDataSegment(pageNumber));
          return;
        }

        var postData = {};
        var alias = attributes.alias || {};

        postData[alias.pageSize ? alias.pageSize : 'pageSize'] = pageSize;
        postData[alias.pageNumber ? alias.pageNumber : 'pageNumber'] = pageNumber;

        var formatAjaxParams = {
          type: 'get',
          cache: false,
          data: {},
          contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
          dataType: 'json',
          async: true
        };

        $.extend(true, formatAjaxParams, attributes.ajax);
        $.extend(formatAjaxParams.data || {}, postData);

        formatAjaxParams.url = attributes.dataSource;
        formatAjaxParams.success = function(response) {
          render(self.filterDataByLocator(response));
        };
        formatAjaxParams.error = function(jqXHR, textStatus, errorThrown) {
          attributes.formatAjaxError && attributes.formatAjaxError(jqXHR, textStatus, errorThrown);
          self.enable();
        };

        self.disable();

        $.ajax(formatAjaxParams);

        function render(data) {
          // Before paging
          if (self.callHook('beforePaging', pageNumber) === false) return false;

          // Pagination direction
          model.direction = typeof model.pageNumber === 'undefined' ? 0 : (pageNumber > model.pageNumber ? 1 : -1);

          model.pageNumber = pageNumber;

          self.render();

          if (self.disabled && !self.sync) {
            // enable
            self.enable();
          }

          // cache model data
          container.data('pagination').model = model;

          // format result before execute callback
          if ($.isFunction(attributes.formatResult)) {
            var cloneData = $.extend(true, [], data);
            if (!Helpers.isArray(data = attributes.formatResult(cloneData))) {
              data = cloneData;
            }
          }

          container.data('pagination').currentPageData = data;

          // callback
          self.doCallback(data, callback);

          // After pageing
          self.callHook('afterPaging', pageNumber);

          // Already the first page
          if (pageNumber == 1) {
            self.callHook('afterIsFirstPage');
          }

          // Already the last page
          if (pageNumber == model.totalPage) {
            self.callHook('afterIsLastPage');
          }
        }
      },

      doCallback: function(data, customCallback) {
        var self = this;
        var model = self.model;

        if ($.isFunction(customCallback)) {
          customCallback(data, model);
        } else if ($.isFunction(attributes.callback)) {
          attributes.callback(data, model);
        }
      },

      destroy: function() {
        // Before destroy
        if (this.callHook('beforeDestroy') === false) return;

        this.model.el.remove();
        container.off();

        // Remove style element
        $('#paginationjs-style').remove();

        // After destroy
        this.callHook('afterDestroy');
      },

      previous: function(callback) {
        this.go(this.model.pageNumber - 1, callback);
      },

      next: function(callback) {
        this.go(this.model.pageNumber + 1, callback);
      },

      disable: function() {
        var self = this;
        var source = self.sync ? 'sync' : 'async';

        // Before disabling
        if (self.callHook('beforeDisable', source) === false) return;

        self.disabled = true;
        self.model.disabled = true;

        // After disabling
        self.callHook('afterDisable', source);
      },

      enable: function() {
        var self = this;
        var source = self.sync ? 'sync' : 'async';

        // Before enabling
        if (self.callHook('beforeEnable', source) === false) return;

        self.disabled = false;
        self.model.disabled = false;

        // After enabling
        self.callHook('afterEnable', source);
      },

      refresh: function(callback) {
        this.go(this.model.pageNumber, callback);
      },

      show: function() {
        var self = this;

        if (self.model.el.is(':visible')) return;

        self.model.el.show();
      },

      hide: function() {
        var self = this;

        if (!self.model.el.is(':visible')) return;

        self.model.el.hide();
      },

      // Replace variables of template
      replaceVariables: function(template, variables) {
        var formattedString;

        for (var key in variables) {
          var value = variables[key];
          var regexp = new RegExp('<%=\\s*' + key + '\\s*%>', 'img');

          formattedString = (formattedString || template).replace(regexp, value);
        }

        return formattedString;
      },

      // Get data segments
      getDataSegment: function(number) {
        var pageSize = attributes.pageSize;
        var dataSource = attributes.dataSource;
        var totalNumber = attributes.totalNumber;

        var start = pageSize * (number - 1) + 1;
        var end = Math.min(number * pageSize, totalNumber);

        return dataSource.slice(start - 1, end);
      },

      // Get total page
      getTotalPage: function() {
        return Math.ceil(attributes.totalNumber / attributes.pageSize);
      },

      // Get locator
      getLocator: function(locator) {
        var result;

        if (typeof locator === 'string') {
          result = locator;
        } else if ($.isFunction(locator)) {
          result = locator();
        } else {
          throwError('"locator" is incorrect. (String | Function)');
        }

        return result;
      },

      // Filter data by "locator"
      filterDataByLocator: function(dataSource) {
        var locator = this.getLocator(attributes.locator);
        var filteredData;

        // Data source is an Object, use "locator" to locate the true data
        if (Helpers.isObject(dataSource)) {
          try {
            $.each(locator.split('.'), function(index, item) {
              filteredData = (filteredData ? filteredData : dataSource)[item];
            });
          }
          catch (e) {
          }

          if (!filteredData) {
            throwError('dataSource.' + locator + ' is undefined.');
          } else if (!Helpers.isArray(filteredData)) {
            throwError('dataSource.' + locator + ' must be an Array.');
          }
        }

        return filteredData || dataSource;
      },

      // Parse dataSource
      parseDataSource: function(dataSource, callback) {
        var self = this;
        var args = arguments;

        if (Helpers.isObject(dataSource)) {
          callback(attributes.dataSource = self.filterDataByLocator(dataSource));
        } else if (Helpers.isArray(dataSource)) {
          callback(attributes.dataSource = dataSource);
        } else if ($.isFunction(dataSource)) {
          attributes.dataSource(function(data) {
            if ($.isFunction(data)) {
              throwError('Unexpect parameter of the "done" Function.');
            }
              self.parseDataSource.call(self, data, callback);
          });
        } else if (typeof dataSource === 'string') {
          if (/^https?|file:/.test(dataSource)) {
            attributes.ajaxDataType = 'jsonp';
          }
          callback(dataSource);
        } else {
          throwError('Unexpect data type of the "dataSource".');
        }
      },

      callHook: function(hook) {
        var paginationData = container.data('pagination');
        var result;

        var args = Array.prototype.slice.apply(arguments);
        args.shift();

        if (attributes[hook] && $.isFunction(attributes[hook])) {
          if (attributes[hook].apply(global, args) === false) {
            result = false;
          }
        }

        if (paginationData.hooks && paginationData.hooks[hook]) {
          $.each(paginationData.hooks[hook], function(index, item) {
            if (item.apply(global, args) === false) {
              result = false;
            }
          });
        }

        return result !== false;
      },

      observer: function() {
        var self = this;
        var el = self.model.el;

        // Go to page
        container.on(eventPrefix + 'go', function(event, pageNumber, done) {
          pageNumber = parseInt($.trim(pageNumber));

          if (!pageNumber) return;

          if (!$.isNumeric(pageNumber)) {
            throwError('"pageNumber" is incorrect. (Number)');
          }

          self.go(pageNumber, done);
        });

        // Page click
        el.delegate('.J-paginationjs-page', 'click', function(event) {
          var current = $(event.currentTarget);
          var pageNumber = $.trim(current.attr('data-num'));

          if (!pageNumber || current.hasClass(attributes.disableClassName) || current.hasClass(attributes.activeClassName)) return;

          // Before page button clicked
          if (self.callHook('beforePageOnClick', event, pageNumber) === false) return false;

          self.go(pageNumber);

          // After page button clicked
          self.callHook('afterPageOnClick', event, pageNumber);

          if (!attributes.pageLink) return false;
        });

        // Previous click
        el.delegate('.J-paginationjs-previous', 'click', function(event) {
          var current = $(event.currentTarget);
          var pageNumber = $.trim(current.attr('data-num'));

          if (!pageNumber || current.hasClass(attributes.disableClassName)) return;

          // Before previous clicked
          if (self.callHook('beforePreviousOnClick', event, pageNumber) === false) return false;

          self.go(pageNumber);

          // After previous clicked
          self.callHook('afterPreviousOnClick', event, pageNumber);

          if (!attributes.pageLink) return false;
        });

        // Next click
        el.delegate('.J-paginationjs-next', 'click', function(event) {
          var current = $(event.currentTarget);
          var pageNumber = $.trim(current.attr('data-num'));

          if (!pageNumber || current.hasClass(attributes.disableClassName)) return;

          // Before next clicked
          if (self.callHook('beforeNextOnClick', event, pageNumber) === false) return false;

          self.go(pageNumber);

          // After next clicked
          self.callHook('afterNextOnClick', event, pageNumber);

          if (!attributes.pageLink) return false;
        });

        // Go button click
        el.delegate('.J-paginationjs-go-button', 'click', function(event) {
          var pageNumber = $('.J-paginationjs-go-pagenumber', el).val();

          // Before Go button clicked
          if (self.callHook('beforeGoButtonOnClick', event, pageNumber) === false) return false;

          container.trigger(eventPrefix + 'go', pageNumber);

          // After Go button clicked
          self.callHook('afterGoButtonOnClick', event, pageNumber);
        });

        // go input enter
        el.delegate('.J-paginationjs-go-pagenumber', 'keyup', function(event) {
          if (event.which === 13) {
            var pageNumber = $(event.currentTarget).val();

            // Before Go input enter
            if (self.callHook('beforeGoInputOnEnter', event, pageNumber) === false) return false;

            container.trigger(eventPrefix + 'go', pageNumber);

            // Regains focus
            $('.J-paginationjs-go-pagenumber', el).focus();

            // After Go input enter
            self.callHook('afterGoInputOnEnter', event, pageNumber);
          }
        });

        // Previous page
        container.on(eventPrefix + 'previous', function(event, done) {
          self.previous(done);
        });

        // Next page
        container.on(eventPrefix + 'next', function(event, done) {
          self.next(done);
        });

        // Disable
        container.on(eventPrefix + 'disable', function() {
          self.disable();
        });

        // Enable
        container.on(eventPrefix + 'enable', function() {
          self.enable();
        });

        // Refresh
        container.on(eventPrefix + 'refresh', function(event, done) {
          self.refresh(done);
        });

        // Show
        container.on(eventPrefix + 'show', function() {
          self.show();
        });

        // Hide
        container.on(eventPrefix + 'hide', function() {
          self.hide();
        });

        // Destroy
        container.on(eventPrefix + 'destroy', function() {
          self.destroy();
        });

        // Whether to load the default page
        if (attributes.triggerPagingOnInit) {
          container.trigger(eventPrefix + 'go', Math.min(attributes.pageNumber, self.model.totalPage));
        }
      }
    };

    // If initial
    if (container.data('pagination') && container.data('pagination').initialized === true) {
      // Handling events
      if ($.isNumeric(options)) {
        // container.pagination(5)
        container.trigger.call(this, eventPrefix + 'go', options, arguments[1]);
        return this;
      } else if (typeof options === 'string') {
        var args = Array.prototype.slice.apply(arguments);
        args[0] = eventPrefix + args[0];

        switch (options) {
          case 'previous':
          case 'next':
          case 'go':
          case 'disable':
          case 'enable':
          case 'refresh':
          case 'show':
          case 'hide':
          case 'destroy':
            container.trigger.apply(this, args);
            break;
          // Get selected page number
          case 'getSelectedPageNum':
            if (container.data('pagination').model) {
              return container.data('pagination').model.pageNumber;
            } else {
              return container.data('pagination').attributes.pageNumber;
            }
          // Get total page
          case 'getTotalPage':
            return container.data('pagination').model.totalPage;
          // Get selected page data
          case 'getSelectedPageData':
            return container.data('pagination').currentPageData;
          // Whether pagination was be disabled
          case 'isDisabled':
            return container.data('pagination').model.disabled === true;
          default:
            throwError('Pagination do not provide action: ' + options);
        }
        return this;
      } else {
        // Uninstall the old instance before initialize a new one
        uninstallPlugin(container);
      }
    } else {
      if (!Helpers.isObject(options)) throwError('Illegal options');
    }

    // Attributes
    var attributes = $.extend({}, $.fn[pluginName].defaults, options);

    // Check parameters
    parameterChecker(attributes);

    pagination.initialize();

    return this;
  };

  // Instance defaults
  $.fn[pluginName].defaults = {

    // Data source
    // Array | String | Function | Object
    //dataSource: '',

    // String | Function
    //locator: 'data',

    // Total entries, must be specified when the pagination is asynchronous
    totalNumber: 1,

    // Default page
    pageNumber: 1,

    // entries of per page
    pageSize: 10,

    // Page range (pages on both sides of the current page)
    pageRange: 2,

    // Whether to display the 'Previous' button
    showPrevious: true,

    // Whether to display the 'Next' button
    showNext: true,

    // Whether to display the page buttons
    showPageNumbers: true,

    showNavigator: false,

    // Whether to display the 'Go' input
    showGoInput: false,

    // Whether to display the 'Go' button
    showGoButton: false,

    // Page link
    pageLink: '',

    // 'Previous' text
    prevText: '&laquo;',

    // 'Next' text
    nextText: '&raquo;',

    // Ellipsis text
    ellipsisText: '...',

    // 'Go' button text
    goButtonText: 'Go',

    // Additional className for Pagination element
    //className: '',

    classPrefix: 'paginationjs',

    // Default active class
    activeClassName: 'active',

    // Default disable class
    disableClassName: 'disabled',

    //ulClassName: '',

    // Whether to insert inline style
    inlineStyle: true,

    formatNavigator: '<%= currentPage %> / <%= totalPage %>',

    formatGoInput: '<%= input %>',

    formatGoButton: '<%= button %>',

    // Pagination element's position in the container
    position: 'bottom',

    // Auto hide previous button when current page is the first page
    autoHidePrevious: false,

    // Auto hide next button when current page is the last page
    autoHideNext: false,

    //header: '',

    //footer: '',

    // Aliases for custom pagination parameters
    //alias: {},

    // Whether to trigger pagination at initialization
    triggerPagingOnInit: true,

    // Whether to hide pagination when less than one page
    hideWhenLessThanOnePage: false,

    showFirstOnEllipsisShow: true,

    showLastOnEllipsisShow: true,

    // Pagging callback
    callback: function() {
    }
  };

  // Hook register
  $.fn[pluginHookMethod] = function(hook, callback) {
    if (arguments.length < 2) {
      throwError('Missing argument.');
    }

    if (!$.isFunction(callback)) {
      throwError('callback must be a function.');
    }

    var container = $(this);
    var paginationData = container.data('pagination');

    if (!paginationData) {
      container.data('pagination', {});
      paginationData = container.data('pagination');
    }

    !paginationData.hooks && (paginationData.hooks = {});

    //paginationData.hooks[hook] = callback;
    paginationData.hooks[hook] = paginationData.hooks[hook] || [];
    paginationData.hooks[hook].push(callback);

  };

  // Static method
  $[pluginName] = function(selector, options) {
    if (arguments.length < 2) {
      throwError('Requires two parameters.');
    }

    var container;

    // 'selector' is a jQuery object
    if (typeof selector !== 'string' && selector instanceof jQuery) {
      container = selector;
    } else {
      container = $(selector);
    }

    if (!container.length) return;

    container.pagination(options);

    return container;
  };

  // ============================================================
  // helpers
  // ============================================================

  var Helpers = {};

  // Throw error
  function throwError(content) {
    throw new Error('Pagination: ' + content);
  }

  // Check parameters
  function parameterChecker(args) {
    if (!args.dataSource) {
      throwError('"dataSource" is required.');
    }

    if (typeof args.dataSource === 'string') {
      if (typeof args.totalNumber === 'undefined') {
        throwError('"totalNumber" is required.');
      } else if (!$.isNumeric(args.totalNumber)) {
        throwError('"totalNumber" is incorrect. (Number)');
      }
    } else if (Helpers.isObject(args.dataSource)) {
      if (typeof args.locator === 'undefined') {
        throwError('"dataSource" is an Object, please specify "locator".');
      } else if (typeof args.locator !== 'string' && !$.isFunction(args.locator)) {
        throwError('' + args.locator + ' is incorrect. (String | Function)');
      }
    }
  }

  // uninstall plugin
  function uninstallPlugin(target) {
    var events = ['go', 'previous', 'next', 'disable', 'enable', 'refresh', 'show', 'hide', 'destroy'];

    // off events of old instance
    $.each(events, function(index, value) {
      target.off(eventPrefix + value);
    });

    // reset pagination data
    target.data('pagination', {});

    // remove old
    $('.paginationjs', target).remove();
  }

  // Object type detection
  function getObjectType(object, tmp) {
    return ( (tmp = typeof(object)) == "object" ? object == null && "null" || Object.prototype.toString.call(object).slice(8, -1) : tmp ).toLowerCase();
  }

  $.each(['Object', 'Array'], function(index, name) {
    Helpers['is' + name] = function(object) {
      return getObjectType(object) === name.toLowerCase();
    };
  });

  /*
   * export via AMD or CommonJS
   * */
  if (typeof define === 'function' && define.amd) {
    define(function() {
      return $;
    });
  }

})(this, window.jQuery);
/*
 * 表单验证
**/
(function(a){
  var bksx = {
    "validate" : function(callB){
      //信息是否有错标志位
      var flag = true;
      //ajax信息是否有错标志位
      var ajaxf = true;

      //验证规则
      var regExp = {
        "full":/[\[\]:?\"{}`=^&!*|;$%@'<>()+\r\n,\\../ ]/igm,
        "full_chinese":/[\[\]:?\"{}`=^&!*|;$%@'<>()+\r\n,\\../ Α-￥]/igm,
        "normal":/[|;$%'<>`()+\r\n,\\../ *]/igm,
        "money":/^(0|(0\.0[1-9])|(0\.[1-9][0-9]?)|([1-9]([0-9]{1,5})?(\.\d{1,2})?))$/igm,
        "less":/.+/igm,
        //"sfzhm":/^[1-9]\d{5}\d{4}[01]\d[0-3]\d{4}[0-9xX]$/igm,
        "yb":/^[0-9]{6}$/igm,
        "email":/^[-\w]?\w+([-+.]\w+)*[-\w]?@[-\w]?\w+([-.]\w+)*[-\w]?\.[-\w]?\w+([-.]\w+)*[-\w]?$/igm,
        "phone":/^1[0-9]{10}$/,
        "lxdh":/^((\d{11})|((\d{3,4}-)?\d{7,8}(-\d{1,4})?))$/igm,
        "url":/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/igm,
        "english":/^[A-Za-z]+$/igm,
        "chinese":/^[\u0391-\uFFE5]+$/igm,
        "qq":/^[1-9]\d{4,9}$/igm,
        "number":/^\d+$/igm,
        "num":/^[1-9]\d*$/igm,
        "integer":/^[-\+]?\d+$/igm,
        "double":/^[-\+]?\d+(\.\d+)?$/igm,
        "posdouble":/^\d+(\.\d+)?$/igm
      }
      //错误提示信息
      var errorMsg = {
        "full":'',
        "normal":'',
        "less":'',
        "sfzhm":'请输入18位有效的身份证号码',
        "yb":'请输入有效邮编号码',
        "sjh":'请输入有效手机号',
        "email":'请输入有效的邮箱地址',
        "lxdh":'请输入有效电话号码',
        "url":'请输入正确的网址',
        "english":'请填写英文',
        "chinese":'请填写中文',
        "qq":'请填写正确的qq号码',
        "number":'请填写合法数字',
        "num":'请填写合法数字',
        "integer":'请填写合法数字',
        "double":'请填写合法数字',
        "posdouble":'请填写合法数字' 
      }

      var _this = $(this);

      //去掉数组重复元素
      function unique(arr) {
        var result = [], hash = {};
        for (var i = 0, elem; (elem = arr[i]) != null; i++) {
          if (!hash[elem]) {
            result.push(elem);
            hash[elem] = true;
          }
        }
        return result;
      }

      //去空格,判断是否为正整数(包含0)
      function _to_trim_all(strValue){
        return (strValue+"").replace(/\s+/g,"");
      }

      //判断是不是正整数
      function isNumber(strValue){
        if(_to_trim_all(strValue)==""){
          return false;
        }
        if(! /^[0-9]*$/.test(strValue)){
            return false;
        }
        return true;
      }
      function isMoney(strValue){
        var _input_value=_to_trim_all(strValue);
        var _index=_input_value.indexOf(".");
        if(isNaN(_input_value)||_index==0||_index==_input_value.length-1||_input_value.toUpperCase().indexOf("E")!=-1){
          return false;
        }
        return true;
      }

      //15位身份证号转成18位
      function convertSfzhm(_sfzhm){
        var  _l_l_jym= new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1);
        var  _l_l_total = 0;
        var  _last_char;
        var _input_value = new String(_sfzhm);
        if (_input_value.length==15){
          var _input_value_temp = _input_value.substring(0,6) + "19" + _input_value.substring(6,15);
          for(var i=0;i<_input_value_temp.length;i++){
            var _l_l_temp_temp = parseInt(_input_value_temp.substr(i,1),10) * _l_l_jym[i];
            _l_l_total += _l_l_temp_temp;
          }
          _l_l_total --;
          var _last_number = _l_l_total % 11;//最后一位
          if (_last_number==0){
            _last_char = 0;
          }else{
            if (_last_number==1){
              _last_char="X";
            }
            else{
              _last_char = 11 - _last_number;
            }
          }
          _input_value_temp = _input_value_temp + _last_char;
          return _input_value_temp;
        }else{
          return _input_value;
        }
      }

      //判断字符串是否符合日期格式，如1999-03-07
      function isDate(theStr) {
        var strObj=new String(theStr);

        var strObjTemp;
        //1.theStr.length<>10
        if(strObj.length!=10&&strObj.length!=7){
          return false;
        }
        //2.判断第五位、第八位是"-"
        if(strObj.substring(4,5)!="-"){
          return false;
        }
        if(strObj.length==10){
          if (strObj.substring(7,8)!="-"){
            return false;
          }
        }
        //3.校验年部分是数字，并在1900~2100之间，月部分是数字，并在1~12之间，日部分是数字，并在1~31之间
        strObjTemp=new String(strObj.substring(0,4));

        if(isNumber(strObjTemp)==false || parseInt(strObjTemp,10)<=1900 || parseInt(strObjTemp,10)>2100)
          return false;
        strObjTemp=new String(strObj.substring(5,7));

        if  (isNumber(strObjTemp)==false || parseInt(strObjTemp,10) < 1  || parseInt(strObjTemp,10)>12)
          return false;

        if(strObj.length==10){
          strObjTemp=new String(strObj.substring(8,10));
          if(isNumber(strObjTemp)==false || parseInt(strObjTemp,10)<1 || parseInt(strObjTemp,10)>31)
            return false;
        }

        if(strObj.length==10){
          if(isRightdate(theStr)==false){
            return false;
          }
        }
        return true;
      }

      //判断是不是合法日期
      function isRightdate(theStr) {
        var strObj=new String(theStr);
        var theYear=parseInt(strObj.substring(0,4),10);
        var theMonth=parseInt(strObj.substring(5,7),10);
        var theDay=parseInt(strObj.substring(8,10),10);
        switch(theMonth){
          case 4:
          case 6:
          case 9:
          case 11:
            if(theDay==31)
              return false;
            else
              break;
          case 2:
            if((theYear%4==0 && theYear%100!=0) || theYear%400==0){//润年2月份29天
              if(theDay>29) return false;
            }
            else{
              if(theDay>28) return false;
            }
            break;
          default: break;
        }
        return true;
      }

      //获取长度 中文和全角符号长度计为2
      function _byte_count(_strvalue) { 
        _strvalue = _strvalue.replace(/([\u0391-\uFFE5])/ig,'xs');
        var count = _strvalue.length;
        return count;
      }
      
      //失焦后判断
      _this.on('blur', '[validate]', function(){
        //功能：是否为空，是否正则匹配，是否溢出
        var matchResult = $(this).val().match(regExp[$(this).attr('validate')]);
        var resultStr = [];
        
        var require = $(this).attr('require');
        var errMsg;
        if($(this).attr('errMsg')){
          errMsg = $(this).attr('errMsg');
        }
        if($(this).attr('tips')){
          tipsMsg = $(this).attr('tips');
        }
        //是否为空
        if(require !== undefined){
          if($(this).val()==''){
            //resultStr = errMsg ? errMsg : tipsMsg + '不能为空';
            resultStr.push(errMsg ? errMsg : tipsMsg + '不能为空');
            //$(this).next('span').html(errMsg ? errMsg : tipsMsg + '不能为空');
            flag = false;
          }
        }

        //正则匹配
        var pattern = $(this).attr('pattern');
        if(pattern){
          var match = $(this).val().match($(this).attr('pattern'));
          if(!match && $(this).val() != ''){
            //resultStr = errMsg ? errMsg : '请输入有效的'+ tipsMsg +'信息';
            resultStr.push(errMsg ? errMsg : '请输入有效的'+ tipsMsg +'信息');
            //$(this).next('span').html(resultStr);
            flag = false;
          }
        }
        //是否溢出
        var maxlen = $(this).attr('maxlen');
        var minlen = $(this).attr('minlen');
        var len = _byte_count($(this).val());
        if(maxlen || minlen){
          if(!($(this).val() == '' || $(this).val() == $(this).attr('placeholder') )){
            if(len > maxlen){
              //resultStr = errMsg ? errMsg : tipsMsg+'最多输入' + maxlen + '个字';
              //$(this).next('span').html(resultStr);
              flag = false;
              resultStr.push(errMsg ? errMsg : tipsMsg+'最多输入' + maxlen + '个字符');
            }
            if(len < minlen){
              //resultStr = errMsg ? errMsg : tipsMsg+'最少输入' + minlen + '个字';
              //$(this).next('span').html(resultStr);
              flag = false;
              resultStr.push(errMsg ? errMsg : tipsMsg+'最少输入' + minlen + '个字符');
            }
          }
        }

        //full normal类型
        if($(this).attr('validate') == 'full' || $(this).attr('validate') == 'normal' || $(this).attr('validate') == 'full_chinese'){
          if(matchResult){
            //resultStr = errMsg ? errMsg : tipsMsg+'含有非法字符'+unique(matchResult).join('');
            //$(this).next('span').html(resultStr);
            flag = false;
            resultStr.push(errMsg ? errMsg : tipsMsg+'含有非法字符'+unique(matchResult).join(''));
          }
        //身份证验证，包含15位扩展到18位
        }else if($(this).attr('validate') == 'sfzhm'){
          var self = $(this);
          self.val(self.val().toUpperCase());
          var self_temp = self.val()+"";
          var self_value = new String(self_temp);
          var self_jym = new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1);
          var self_total = 0;
          //位数校验
          if (self_temp && self_value.length!=15 && self_value.length!=18){
            //resultStr = errMsg ? errMsg : tipsMsg+'必须为15位或18位';
            //$(this).next('span').html(resultStr);
            flag = false;
            resultStr.push(errMsg ? errMsg : tipsMsg+'必须为15位或18位');
          }
          //15校验
          if (self_value.length == 15){ 
              if(isNumber(self_value)==false){
              //resultStr = errMsg ? errMsg : tipsMsg+'输入错误，应全为数字';
              //$(this).next('span').html(resultStr);
                flag = false; 
                resultStr.push(errMsg ? errMsg : tipsMsg+'输入错误，应全为数字'); 
              }   
            //15位转18位
            self_value = convertSfzhm(self_value);
          }       
          var _l_s_temp = self_value.substr(0,17);
          if (self_temp && isNumber(_l_s_temp)==false){
            //resultStr = errMsg ? errMsg : tipsMsg+'前17位输入错误，应全为数字';
            //$(this).next('span').html(resultStr);
              flag = false;
              resultStr.push(errMsg ? errMsg : tipsMsg+'前17位输入错误，应全为数字');       
          }     
          var _last_char = self_value.substring(17,18);
          if (self_temp && isNumber(_last_char)==false && _last_char!="x" && _last_char!="X"){
            //resultStr = errMsg ? errMsg : tipsMsg+'最后一位输入错误';
            //$(this).next('span').html(resultStr);
            flag = false;
            resultStr.push(errMsg ? errMsg : tipsMsg+'最后一位输入错误');   
          }
          var _l_s_temp_temp = self_value.substr(6,8);
          var _l_s_temp  = new String(_l_s_temp_temp);
          var _year  = _l_s_temp.substring(0,4);
          var _month = _l_s_temp.substring(4,6);
          var _day   = _l_s_temp.substring(6,8);
          var _l_l_temp_temp;
          var _l_s_csny = _year + "-" + _month + "-" + _day;
          //是否是合法日期
          if (self_temp && isDate(_l_s_csny)==false){
            //resultStr = errMsg ? errMsg : tipsMsg+'出生年月日不正确';
            //$(this).next('span').html(resultStr);
            flag = false;
            resultStr.push(errMsg ? errMsg : tipsMsg+'出生年月日不正确');
          }
          for(var i=0;i<self_value.length - 1;i++){
            _l_l_temp_temp = parseInt(self_value.substr(i,1),10) * self_jym[i];
            self_total += _l_l_temp_temp;
          }
          if (isNumber(self_value.substring(17,18))){
            self_total += parseInt(self_value.substring(17,18),10);
          }
          if (self_value.substring(17,18)=="X" || self_value.substring(17,18)=="x"){
            self_total += 10;
          }
          self_total --;
          if (self_temp && self_total%11!=0){
            console.log(11);
            //resultStr = errMsg ? errMsg : tipsMsg+'输入不正确';
            //$(this).next('span').html(resultStr);
            flag = false;
            resultStr.push(errMsg ? errMsg : tipsMsg+'输入不正确');
          }
          self.val(self_value);
        //小数保留几位验证
        }else if($(this).attr('validate') == 'double' && matchResult){
          if($(this).val()){
            var self = $(this);
            var maxf = self.attr('maxf') ? self.attr('maxf') : 2;
            var _input_value = _to_trim_all(self.val());
            var _index = _input_value.indexOf(".");
            var _index_length = _input_value.substr(_index+1).length;
            var fl = new String;
            if(_index == -1){
              for( var i=0; i<maxf; i++){
                fl += '0';
              }
              _input_value = _input_value + '.' + fl;
              self.val(_input_value);
            }else{
              if(_index_length > maxf){
                //resultStr = errMsg ? errMsg : tipsMsg+'小数点后最多输入'+ maxf +'位';
                //$(this).next('span').html(resultStr);
                flag = false;
                resultStr.push(errMsg ? errMsg : tipsMsg+'小数点后最多输入'+ maxf +'位');
              }else{
                var nowl = maxf - _index_length;
                for( var i=0; i<nowl; i++){
                  fl += '0';
                }
                _input_value = _input_value + fl;
                self.val(_input_value);
              }
            }
          }
        }else{
          //输入错误信息
          if(!matchResult && $(this).val() != ''){
            //resultStr = errMsg ? errMsg : tipsMsg+'输入不正确';
            //$(this).next('span').html(resultStr);
            //return false;
            resultStr.push(errMsg ? errMsg : tipsMsg+'输入不正确');
          }else if($(this).attr('validate') == 'vserve'){
            //服务器验证信息 
            if(sessionStorage.getItem('id_token')){
              a.ajaxSetup({
                  headers: {         
                    'Authorization':'Bearer ' +  sessionStorage.getItem('id_token')
                  }
              });
            }
            var now = $(this);
            var url  = now.attr('val-url');
            var postData = JSON.stringify(now.val());
            var succMsg;
            if($(this).attr('succMsg')){
              succMsg = $(this).attr('succMsg');
            }
            a.ajax({
              "url":url,
              "type":"POST",
              "data":postData,
              "success":function(data){
                now.next('span').html(succMsg ? succMsg : "信息验证成功");
                now.next('span').css("color","#09dd3a");
              },
              "error":function(jqXHR,textStatus,errorThrown){
                resultStr.push(errMsg ? errMsg : jqXHR.statusText);
                var span_c='';
                for(var i=0; i<resultStr.length; i++){
                  if(i<resultStr.length-1){
                    span_c += resultStr[i]+'</br>'; 
                  }else{
                    span_c += resultStr[i]; 
                  }
                }
                now.next('span').html(span_c);
                ajaxf = false;
              }
            });
          
          }
        }
        var span_c='';
        for(var i=0; i<resultStr.length; i++){
          if(i<resultStr.length-1){
            span_c += resultStr[i]+'</br>'; 
          }else{
            span_c += resultStr[i]; 
          }
        }
        $(this).next('span').html(span_c);
      });


      //聚焦清除
      _this.on('focus', '[validate]', function(){
        if(!$(this).val()){
          $(this).next('span').html('');
        }
        if($(this).next('span').html()){
          $(this).next('span').html('');
        }
        flag = true;
      });
      $('input:checkbox').click(function(){
        $(this).siblings('span').html('');
      })

      //存在必填项并且未输入任何信息，点击提交进行检测
      function vrequire(){
        var is_right = true;
        //必填input验证
        $("input[require]").each(function(i){
          if($(this).val() == ''){
            is_right = false;
            errMsg = $(this).attr('errMsg');
            tipsMsg = $(this).attr('tips');
            var resultStr = errMsg ? errMsg : tipsMsg+'不能为空';
            $(this).next('span').html(resultStr);
          }
        });
        //必填textarea验证
        $("textarea[require]").each(function(i){
          if($(this).val() == ''){
            is_right = false;
            errMsg = $(this).attr('errMsg');
            tipsMsg = $(this).attr('tips');
            var resultStr = errMsg ? errMsg : tipsMsg+'不能为空';
            $(this).next('span').html(resultStr);
          }
        });

        return is_right;
      }

      //checkbox
      function vcheckbox(_this){
        var is_right = true;
        var resultStr;
        var un_check = _this.find('input:checkbox');
        var check = _this.find('input:checkbox:checked')
        var min = un_check.attr('minnum');
        var max = un_check.attr('maxnum');
        if(un_check.length){
          if(check.length >= min && check.length <= max){
            is_right = true;
          }else if(check.length > max){
            errMsg = un_check.attr('errMsg');
            tipsMsg = un_check.attr('tips');
            resultStr = errMsg ? errMsg : tipsMsg+'至多选择' + max + '项';
            un_check.siblings('span').html(resultStr);
            is_right = false;
          }else{
            errMsg = un_check.attr('errMsg');
            tipsMsg =   un_check.attr('tips');
            resultStr = errMsg ? errMsg : tipsMsg+'至少选择' + min + '项';
            un_check.siblings('span').html(resultStr);
            is_right = false;
          }
        }
        
        return is_right;
      }

      //获取提交按钮
      _this.find('[vtotal]').click(function(){
        var is_right;
        var r = vrequire(_this);
        var v_r = true;
        _this.find('input').next('span').each(function(i){
            if($(this).html()){
                  v_r = false;
            }
        });
        _this.find('textarea').next('span').each(function(i){
            if($(this).html()){
                  v_r = false;
            }
        });
        var v_c = vcheckbox(_this);
        if(ajaxf && flag && r && v_r && v_c){
            //alert("验证通过内容");
            if(callB){
              callB();
            }
            
        }else{
            alert("验证不通过内容");
        }
      });
    }
  }

  a.fn.extend(bksx);
})(jQuery);